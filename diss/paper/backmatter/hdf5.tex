\chapter{Cyclopts HDF5 Database Layout}\label{app:hdf5}

This appendix details the exact database layout used by Cyclopts for the
ExchangeFamily, StructuredRequest species, and StructuredSupply species.

\section{Parameter Space}

Both front-end and back-end species record the state of every point in a given
parameter space in a data set called \code{/Species/<species type>/Points},
where \code{<species type>} is either \code{StructuredRequest} or
\code{StructuredSupply}. Each point incorporates both fundamental and instance
parameters as described in \S \ref{method:setup}. The tables associated with
parameter spaces are described below.

\begin{table}[h!]
\centering
\label{tbl:/Species/StructuredRequest/Points}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Species/StructuredRequest/Points| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
paramid & 16-character string & The hex value of a UUID for a point in parameter space. \\ \hline
family & 30-character string & A description of the problem family \\ \hline
f\_fc & 1-byte integer & As described in \S \ref{method:setup} \\ \hline
f\_loc & 1-byte integer & As described in \S \ref{method:setup} \\ \hline
f\_mox & 4-byte float & As described in \S \ref{method:setup} \\ \hline
f\_rxtr & 1-byte integer & As described in \S \ref{method:setup} \\ \hline
n\_reg & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_rxtr & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
r\_inv\_proc & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_l\_c & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_s\_mox & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_s\_mox\_uox & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_s\_th & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_s\_thox & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_t\_f & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_th\_pu & 4-byte float & As described in \S \ref{method:setup} \\ \hline
seed & 8-byte integer & The random seed used to generate an instance. \\ \hline
\end{tabularx}
\end{table}


\begin{table}[h!]
\centering
\label{tbl:/Species/StructuredSupply/Points}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Species/StructuredSupply/Points| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
paramid & 16-character string & The hex value of a UUID for a point in parameter space. \\ \hline
family & 30-character string & A description of the problem family \\ \hline
d\_f\_mox & 4-length array of 8-byte floats & As described in \S \ref{method:setup} \\ \hline
d\_f\_thox & 4-length array of 8-byte floats & As described in \S \ref{method:setup} \\ \hline
d\_th & 3-length array of 8-byte floats & As described in \S \ref{method:setup} \\ \hline
f\_fc & 1-byte integer & As described in \S \ref{method:setup} \\ \hline
f\_loc & 1-byte integer & As described in \S \ref{method:setup} \\ \hline
f\_mox & 4-byte float & As described in \S \ref{method:setup} \\ \hline
f\_rxtr & 1-byte integer & As described in \S \ref{method:setup} \\ \hline
n\_reg & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_rxtr & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
r\_inv\_proc & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_l\_c & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_repo & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_s\_mox & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_s\_mox\_uox & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_s\_th & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_s\_thox & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_t\_f & 4-byte float & As described in \S \ref{method:setup} \\ \hline
r\_th\_pu & 4-byte float & As described in \S \ref{method:setup} \\ \hline
seed & 8-byte integer & The random seed used to generate an instance. \\ \hline
\end{tabularx}
\end{table}

\section{Problem Instances}

Problem instances are generated by problem species and are executed by problem
families. Accordingly, both species and families can record information about
instances. Front and back-end exchange species each record two types of
information: details about each arc in an instance and a summary of
species-specific information. The exchange family records information regarding
each of the entities that comprise an instance: nodes, groups of nodes (having
been translated from portfolios), and arcs. Further, aggregate summary
information is also recorded. 

\subsection{Exchange Family}

The exchange family records information regarding all major constructs in an
exchange: nodes, groups, and arcs. A summary table is written to
\code{/Family/ResourceExchange/ExchangeInstProperties}. Nodes and group data are
recorded in an aggregate dataset located at
\code{/Family/ResourceExchange/ExchangeNodes}; node group data is located at
\code{/Family/ResourceExchange/ExchangeGroups}; and arc data is collected in the
\code{/Family/ResourceExchange/ExchangeArcs} group. A dataset per instance UUID
is used because it has been found to be useful in the postprocessing phase. A
summary of family-specific instance data are detailed below.

\begin{table}[h!]
\centering
\label{tbl:/Family/ResourceExchange/ExchangeInstProperties}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Family/ResourceExchange/ExchangeInstProperties| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
paramid & 16-character string & The hex value of a UUID for a point in parameter space. \\ \hline
instid & 16-character string & The hex value of a UUID for an NFCTP graph instance. \\ \hline
species & 30-character string & A description of a problem species. \\ \hline
n\_arcs & 8-byte integer & The number of arcs in an NFCTP instance. \\ \hline
n\_u\_grps & 8-byte integer & The number of supply groups in an NFCTP instance. \\ \hline
n\_v\_grps & 8-byte integer & The number of demand groups in an NFCTP instance. \\ \hline
n\_u\_nodes & 8-byte integer & The number of supply nodes in an NFCTP instance. \\ \hline
n\_v\_nodes & 8-byte integer & The number of demand nodes in an NFCTP instance. \\ \hline
n\_constrs & 8-byte integer & The number of constraints in an NFCTP instance. \\ \hline
excl\_frac & 8-byte float & The fraction of arcs in a NFCTP graph that are exclusive. \\ \hline
\end{tabularx}
\end{table}

\begin{table}[h!]
\centering
\label{tbl:/Family/ResourceExchange/ExchangeNodes}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Family/ResourceExchange/ExchangeNodes| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
instid & 16-character string & The hex value of a UUID for an NFCTP graph instance. \\ \hline
id & 8-byte integer & A uniquely identifying value. \\ \hline
gid & 8-byte integer & A unique value identifying an ExchangeGroup \\ \hline
kind & 1-byte integer bitfield & Whether an object is associated with supply or demand. \\ \hline
qty & 8-byte float & A quantity. \\ \hline
excl & 1-byte integer bitfield & Whether or not an arc is exclusive. \\ \hline
excl\_id & 8-byte integer & A unique value identifying the mutually exclusive group an arc belongs to. \\ \hline
\end{tabularx}
\end{table}

\begin{table}[h!]
\centering
\label{tbl:/Family/ResourceExchange/ExchangeGroups}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Family/ResourceExchange/ExchangeGroups| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
instid & 16-character string & The hex value of a UUID for an NFCTP graph instance. \\ \hline
id & 8-byte integer & A uniquely identifying value. \\ \hline
kind & 1-byte integer bitfield & Whether an object is associated with supply or demand. \\ \hline
caps & 4-length array of 8-byte floats & Capacity RHS values. \\ \hline
cap\_dirs & 4-length array of 1-byte integer bitfields & Whether a constraint is greater or less-than \\ \hline
qty & 8-byte float & A quantity. \\ \hline
\end{tabularx}
\end{table}

\begin{table}[h!]
\centering
\label{tbl:/Family/ResourceExchange/ExchangeArcs/id_8017b48888ac424fb991527195a831b6}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Family/ResourceExchange/ExchangeArcs/<Instance UUID>| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
id & 8-byte integer & A uniquely identifying value. \\ \hline
uid & 8-byte integer & Supply node for an arc. \\ \hline
ucaps & 4-length array of 8-byte floats & Capacity coefficients for a supply node. \\ \hline
vid & 8-byte integer & Request node for an arc. \\ \hline
vcaps & 4-length array of 8-byte floats & Capacity coefficients for a request node. \\ \hline
pref & 8-byte float & Preference value of an arc. \\ \hline
\end{tabularx}
\end{table}

\subsection{Exchange Species}

Both exchange species record information about each arc in an exchange
instance. A parent group for arc data is defined under each species group. A
group for each instance, whose name is the hex string of the UUID, is defined
under the associated arc group. Finally, arc information associated with each
instance is stored as a dataset in that instance's group. For example, the arc
data for a given UUID of a front-end exchange is located as a dataset in the
group \code{/Species/StructuredRequest/Arcs/<UUID hex>}. Summary information
related to each species is also recorded in a data set for each species type
located in the group \code{/Species/<species type>/Summary}. Tables describing
species-specific instance data are detailed below.

\begin{table}[h!]
\centering
\label{tbl:/Species/StructuredRequest/Arcs/id_8017b48888ac424fb991527195a831b6}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Species/<Species Type>/Arcs/<Instance UUID>| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
arcid & 4-byte unsigned integer & The hex value of a UUID for an arc. \\ \hline
commod & 4-byte unsigned integer & The commodity associated with an arc. \\ \hline
pref\_c & 4-byte float & Commodity-based preference of an arc. \\ \hline
pref\_l & 4-byte float & Location-based preference of an arc. \\ \hline
\end{tabularx}
\end{table}

\begin{table}[h!]
\centering
\label{tbl:/Species/StructuredRequest/Summary}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Species/StructuredRequest/Summary| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
paramid & 16-character string & The hex value of a UUID for a point in parameter space. \\ \hline
family & 30-character string & A description of the problem family \\ \hline
n\_r\_th & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_r\_f\_mox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_r\_f\_thox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_s\_uox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_s\_th\_mox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_s\_f\_mox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_s\_f\_thox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
\end{tabularx}
\end{table}

\begin{table}[h!]
\centering
\label{tbl:/Species/StructuredSupply/Summary}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Species/StructuredSupply/Summary| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
paramid & 16-character string & The hex value of a UUID for a point in parameter space. \\ \hline
family & 30-character string & A description of the problem family \\ \hline
n\_r\_th & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_r\_f\_mox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_r\_f\_thox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_s\_uox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_s\_th\_mox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_s\_f\_mox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_s\_f\_thox & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
n\_s\_repo & 4-byte unsigned integer & As described in \S \ref{method:setup} \\ \hline
\end{tabularx}
\end{table}

\section{Solutions}

For every solution, data is added to the Cyclopts Results dataset. Problem
solutions are constructed from problem instances, and are thus managed by a
problem family. Aggregate solution information is provided in a family dataset
\code{/Family/ResourceExchange/ExchangeSolutionProperties}. The full results of
each solve, i.e., the amount of resources flowing across each arc, are recorded
in a group specific to each solution UUID. Tables related to instance solutions
are described below.

\begin{table}[h!]
\centering
\label{tbl:/Results}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Results| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
solnid & 16-character string & The hex value of a UUID for a solution to an ExchangeGraph instance. \\ \hline
instid & 16-character string & The hex value of a UUID for an NFCTP graph instance. \\ \hline
solver & 30-character string & A description of the solver used. \\ \hline
problem & 30-character string & A description of the problem family. \\ \hline
time & 8-byte float & How long a solution took. \\ \hline
objective & 8-byte float & The objective value associated with a solution. \\ \hline
cyclopts\_version & 12-character string & The version of Cyclopts used to generate a solution. \\ \hline
timestamp & 26-character string & A timestamp of when a solution was ran. \\ \hline
\end{tabularx}
\end{table}

\begin{table}[h!]
\centering
\label{tbl:/Family/ResourceExchange/ExchangeInstSolutionProperties}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Family/ResourceExchange/ExchangeInstSolutionProperties| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
solnid & 16-character string & The hex value of a UUID for a solution to an ExchangeGraph instance. \\ \hline
instid & 16-character string & The hex value of a UUID for an NFCTP graph instance. \\ \hline
pref\_flow & 8-byte float & The value of the product of preference and flow for arcs. \\ \hline
cyclus\_version & 20-character string & The version of Cyclus used to generate a solution. \\ \hline
\end{tabularx}
\end{table}

\begin{table}[h!]
\centering
\label{tbl:/Family/ResourceExchange/ExchangeInstSolutions/id_2fa2ee6eb9654baf8780a99713dd5e69}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Family/ResourceExchange/ExchangeInstSolutions/<Solution UUID>| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
arc\_id & 8-byte integer &  \\ \hline
flow & 8-byte float &  \\ \hline
\end{tabularx}
\end{table}

\section{Post Processing}

Given a full set of parameter, instance, and solution data, postprocessing may
be applied to family and species data. The exchange family, front-end species,
and back-end species each contain a \code{PostProcess} dataset. Tables
associated with post processing are described below.

\begin{table}[h!]
\centering
\label{tbl:/Family/ResourceExchange/PostProcess}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Family/ResourceExchange/PostProcess| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
solnid & 16-character string & The hex value of a UUID for a solution to an ExchangeGraph instance. \\ \hline
pref\_flow & 8-byte float & The value of the product of preference and flow for arcs. \\ \hline
\end{tabularx}
\end{table}

\begin{table}[h!]
\centering
\label{tbl:/Species/StructuredRequest/PostProcess}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Species/StructuredRequest/PostProcess| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
solnid & 16-character string & The hex value of a UUID for a solution to an ExchangeGraph instance. \\ \hline
c\_pref\_flow & 8-byte float & The value of the product of commodity-based preference and flow for arcs. \\ \hline
l\_pref\_flow & 8-byte float & The value of the product of location-based preference and flow for arcs. \\ \hline
\end{tabularx}
\end{table}

\begin{table}[h!]
\centering
\label{tbl:/Species/StructuredSupply/PostProcess}
\caption{Datatype description of the \lstinline[basicstyle=\ttfamily\color{black}]|/Species/StructuredSupply/PostProcess| dataset.}
\begin{tabularx}{\columnwidth-10pt}{|c|c|X|} % line wraps second column if too long
\hline
\textbf{Name} & \textbf{Data Type} & \textbf{Description}       \\ \hline
solnid & 16-character string & The hex value of a UUID for a solution to an ExchangeGraph instance. \\ \hline
c\_pref\_flow & 8-byte float & The value of the product of commodity-based preference and flow for arcs. \\ \hline
l\_pref\_flow & 8-byte float & The value of the product of location-based preference and flow for arcs. \\ \hline
\end{tabularx}
\end{table}

